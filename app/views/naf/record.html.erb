<% content_for :body do %>
  <div id="record">

    <%= render :partial => 'naf/shared/information_container', :locals => { :record_name => model_name } %>

    <%= generate_back_link %>
    <% if !generate_edit_link.blank? && !generate_back_link.blank? %>
      &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
    <% end %>
    <%= generate_edit_link %>

    <div id="flash_message">
        <% unless notice.blank? %>
          <script type='text/javascript'>
            jQuery("<p id='notice'><%= notice %></p>")
                .appendTo('#flash_message')
                .slideDown().delay(5000).slideUp();
          </script>
        <% end %>
    </div>

    <table id="table_record">

      <tr>
        <th>Attribute</th>
        <th>Value</th>
      </tr>

      <tbody>
      <% @attributes.each do |a| %>
          <tr>
            <td scope="row"><%= make_header(a.to_s) %></td>
            <% if a == :title and controller_name == 'jobs' %>
                <% if application = @record.application %>
                    <td> <%= link_to @record.send(a), url_for(application) %> </td>
                <% else %>
                    <td> <%= @record.send(a) %> </td>
                <% end %>
            <% else %>
                <td> <%= @record.send(a) %></td>
            <% end %>
          </tr>
      <% end %>
      <% if controller_name == 'jobs' %>
          <script type='text/javascript'>
              jQuery(document).ready(function () {
                  jQuery('.terminate').click(function () {
                      var answer = confirm("You are terminating this job. Are you sure you want to do this?");
                      if (!answer) {
                          return false;
                      }
                      var id = <%= @record.id %>;
                      var url = '/job_system/jobs/' + id;
                      jQuery.ajax({
                          url:url,
                          type:'POST',
                          dataType:'json',
                          data:{ "job[request_to_terminate]":1, "job_id":id, "_method":"put" },
                          success:function (data) {
                              if (data.success) {
                                  jQuery("<p id='notice'>A Job was terminated!</p>").
                                      appendTo('#flash_message').slideDown().delay(5000).slideUp();
                                  setTimeout('window.location.reload()', 5600);
                              }
                          }
                      });
                  });
              });
          </script>
          <% unless @record.request_to_terminate %>
            <tr>
              <td>Terminate Job</td>
              <td>
                <%= link_to image_tag('terminate.png', :class => 'action', :title => 'Terminate Job'), "#", {:class => "terminate"} %>
              </td>
            </tr>
          <% end %>



      <% elsif controller_name == 'applications' %>
        <% content_for :javascripts do %>
          <script type='text/javascript'>
              jQuery(document).ready(function () {
                  jQuery('.enqueue').click(function () {
                      var postSource = "<%= naf.jobs_path %>";
                      var answer = confirm("Adding application as a job on the queue?");
                      if (!answer) {
                          return false;
                      }
                      jQuery.post(postSource, { "job[application_id]":jQuery(this).attr('id') }, function (data) {
                          if (data.success) {
                              jQuery("<p id='notice'>Congratulations, a Job was added!</p>").
                                      appendTo('#flash_message').slideDown().delay(5000).slideUp();
                              setTimeout('window.location.reload()', 5600);
                          }
                      });
                  });
              });
          </script>
        <% end %>
          <tr>
            <td scope="row">Last Queued At</td>
            <td> <%= last_queued_at_link(@record) %> </td>
          </tr>

          <tr>
            <td>Add Script to Jobs Queue</td>
            <td>
              <%= link_to image_tag('control_play_blue.png', :class => 'action', :title => 'Enqueue Now'), "#", {:class => "enqueue", :id => @record.id} %>
            </td>
          </tr>

      <% end %>
      </tbody>
    </table>
    <br/>
    <%= generate_child_resources_link %>
    <% if !generate_destroy_link.blank? && !generate_child_resources_link.blank? %>
      &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
    <% end %>
    <%= generate_destroy_link %>

    <% if(controller_name == 'jobs' || controller_name == 'machines') %>
        <h4>Stdout</h4>
        <iframe src="<%= papertrail_link(@record, true) %>" id="stdout" class="scrollable-output">
            Your browser doesn't support iframe!
        </iframe>
    <% end %>
  </div>

<% end %>

<%= render :partial => 'naf/shared/application' %>
